"use strict";var Slowparse=function(){function b(b){return b.replace(/&([A-Za-z]+);/g,function(b,c){return c=c.toLowerCase(),c in a?a[c]:b})}function c(a){this.name="ParseError";if(!(a in d))throw new Error("Unknown ParseError type: "+a);var b=[];for(var c=1;c<arguments.length;c++)b.push(arguments[c]);var e=d[a].apply(d,b);e=d._combine({type:a},e),this.message=a,this.parseInfo=e}function e(a){this.text=a,this.pos=0,this.tokenStart=0}function f(a,b){this.stream=a,this.domBuilder=b}function g(a,b){this.stream=a,this.domBuilder=b,this.cssParser=new f(a,b)}function h(a){this.document=a,this.fragment=a.createDocumentFragment(),this.currentNode=this.fragment}var a={lt:"<",gt:">",apos:"'",quot:'"',amp:"&"};c.prototype=Error.prototype;var d={_combine:function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c},UNCLOSED_TAG:function(a){return{openTag:this._combine({name:a.domBuilder.currentNode.nodeName.toLowerCase()},a.domBuilder.currentNode.parseInfo.openTag)}},INVALID_TAG_NAME:function(a,b){return{openTag:this._combine({name:a},b.interval)}},UNEXPECTED_CLOSE_TAG:function(a,b,c){return{closeTag:this._combine({name:b},c.interval)}},MISMATCHED_CLOSE_TAG:function(a,b,c,d){return{openTag:this._combine({name:b},a.domBuilder.currentNode.parseInfo.openTag),closeTag:this._combine({name:c},d.interval)}},CLOSE_TAG_FOR_VOID_ELEMENT:function(a,b,c){return{closeTag:this._combine({name:b},c.interval)}},UNTERMINATED_COMMENT:function(a){return{start:a.interval.start}},UNTERMINATED_ATTR_VALUE:function(a,b){return{openTag:this._combine({name:a.domBuilder.currentNode.nodeName.toLowerCase()},a.domBuilder.currentNode.parseInfo.openTag),attribute:{name:{value:b.value,start:b.interval.start,end:b.interval.end},value:{start:a.stream.makeToken().interval.start}}}},UNQUOTED_ATTR_VALUE:function(a){var b=a.stream.pos;return a.stream.end()||(b=a.stream.makeToken().interval.start),{start:b}},UNTERMINATED_OPEN_TAG:function(a){return{openTag:{start:a.domBuilder.currentNode.parseInfo.openTag.start,end:a.stream.pos,name:a.domBuilder.currentNode.nodeName.toLowerCase()}}},SELF_CLOSING_NON_VOID_ELEMENT:function(a,b){return{name:b,start:a.domBuilder.currentNode.parseInfo.openTag.start,end:a.stream.makeToken().interval.end}},UNTERMINATED_CLOSE_TAG:function(a){var b=a.stream.pos;return a.stream.end()||(b=a.stream.makeToken().interval.start),{closeTag:{name:a.domBuilder.currentNode.nodeName.toLowerCase(),start:a.domBuilder.currentNode.parseInfo.closeTag.start,end:b}}},MISSING_CSS_SELECTOR:function(a,b,c){return{cssBlock:{start:b,end:c}}},UNFINISHED_CSS_SELECTOR:function(a,b,c,d){return{cssSelector:{start:b,end:c,selector:d}}},MISSING_CSS_BLOCK_OPENER:function(a,b,c,d){return{cssSelector:{start:b,end:c,selector:d}}},INVALID_CSS_PROPERTY_NAME:function(a,b,c,d){return{cssProperty:{start:b,end:c,property:d}}},MISSING_CSS_PROPERTY:function(a,b,c,d){return{cssSelector:{start:b,end:c,selector:d}}},UNFINISHED_CSS_PROPERTY:function(a,b,c,d){return{cssProperty:{start:b,end:c,property:d}}},MISSING_CSS_VALUE:function(a,b,c,d){return{cssProperty:{start:b,end:c,property:d}}},UNFINISHED_CSS_VALUE:function(a,b,c,d){return{cssValue:{start:b,end:c,value:d}}},MISSING_CSS_BLOCK_CLOSER:function(a,b,c,d){return{cssValue:{start:b,end:c,value:d}}},UNCAUGHT_CSS_PARSE_ERROR:function(a,b,c,d){return{error:{start:b,end:c,msg:d}}},UNTERMINATED_CSS_COMMENT:function(a){return{start:a}}};e.prototype={peek:function(){return this.text[this.pos]},next:function(){if(!this.end())return this.text[this.pos++]},end:function(){return this.pos==this.text.length},eat:function(a){if(!this.end()&&this.peek().match(a))return this.next()},eatWhile:function(a){var b=!1;while(!this.end()){if(!this.eat(a))return b;b=!0}},eatSpace:function(){return this.eatWhile(/[\s\n]/)},eatCSSWhile:function(a){var b=!1,c="",d="",e="";while(!this.end()){c=this.eat(a);if(!c)return b;b=!0;if(c==="/"){d=this.peek();if(d==="*"){while(e!=="/"&&!this.end())this.eatWhile(/[^*]/),this.next(),e=this.next();e=""}}}},markTokenStart:function(){this.tokenStart=this.pos},markTokenStartAfterSpace:function(){this.eatSpace(),this.markTokenStart()},makeToken:function(){if(this.pos==this.tokenStart)return null;var a={value:this.text.slice(this.tokenStart,this.pos),interval:{start:this.tokenStart,end:this.pos}};return this.tokenStart=this.pos,a},match:function(a,b,c){var d=this.text.slice(this.pos,this.pos+a.length);return c&&(a=a.toLowerCase(),d=d.toLowerCase()),a==d?(b&&(this.pos+=a.length),!0):!1}},f.prototype={cssProperties:["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","filter","fit","fit-position","flex-align","flex-flow","flex-line-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","src","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-shadow","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index"],_knownCSSProperty:function(a){return a=a.replace(/^-.+?-/,""),this.cssProperties.indexOf(a)>-1},parse:function(){this.rules=[],this.comments=[];var a=this.stream.pos;this.stream.markTokenStartAfterSpace(),this._parseSelector();var b=this.stream.pos,c={value:this.stream.text.slice(a,b),parseInfo:{start:a,end:b,rules:this.rules,comments:this.comments}};return this.rules=null,this.comments=null,c},stripComments:function(a,b){var d,e=a.length,f,g,h,i,j="";for(d=0;d<e;d++)if(a[d]==="/"&&d<e-1&&a[d+1]==="*"){f=b+d,d+=3;while(d<e-1&&a.substr(d-1,2)!=="*/")d++;if(d>=e-1&&a.substr(d-1,2)!=="*/")throw new c("UNTERMINATED_CSS_COMMENT",f);g=b+d+1,this.comments.push({start:f,end:g})}else j+=a[d];return j},_parseSelector:function(){this.currentRule&&(this.rules.push(this.currentRule),this.currentRule=null),this.stream.eatCSSWhile(/[^\{;\}<]/);var a=this.stream.makeToken(),b=this.stream.peek();if(a===null){if(!this.stream.end()&&this.stream.peek()==="<")return;throw new c("MISSING_CSS_SELECTOR",this,this.stream.pos-1,this.stream.pos)}a.value=a.value.trim();var d=a.value,e=a.interval.start,f=e+d.length;d=this.stripComments(d,e).trim();if(d===""){this._parseSelector();return}this.currentRule={selector:{value:d,start:e,end:f},declarations:{start:null,end:null,properties:[]}};if(this.stream.end()||b==="<")throw new c("UNFINISHED_CSS_SELECTOR",this,e,f,d);if(!!this.stream.end())throw new c("MISSING_CSS_BLOCK_OPENER",this,e,f,d);var g=this.stream.next(),h="[_parseSelector] Expected {, }, ; or :, instead found "+g;if(g!=="{")throw g===";"||g==="}"?new c("MISSING_CSS_BLOCK_OPENER",this,e,f,d):new c("UNCAUGHT_CSS_PARSE_ERROR",this,a.interval.start,a.interval.end,h);this.currentRule.declarations.start=this.stream.pos-1,this._parseDeclaration(d,e)},_parseDeclaration:function(a,b,d){this.stream.markTokenStartAfterSpace();var e=this.stream.peek();if(e==="}")this.stream.next(),this.currentRule.declarations.end=this.stream.pos,this.stream.markTokenStartAfterSpace(),this._parseSelector();else{if(d&&(this.stream.end()||e==="<"))throw new c("MISSING_CSS_BLOCK_CLOSER",this,b,b+d.length,d);this._parseProperty(a,b)}},_parseProperty:function(a,b){var d=this.stream.eatCSSWhile(/[^\{\}<;:]/),e=this.stream.makeToken();if(e===null)throw new c("MISSING_CSS_PROPERTY",this,b,b+a.length,a);var d=e.value.trim(),f=e.interval.start,g=f+d.length;d=this.stripComments(d,f).trim();if(d===""){this._parseDeclaration(a,b);return}var h=this.stream.next(),i="[_parseProperty] Expected }, {, <, ; or :, instead found "+h;if(h==="{")throw new c("MISSING_CSS_BLOCK_CLOSER",this,b,f,a);if(this.stream.end()&&h!==":"||h==="<"||h==="}")throw new c("UNFINISHED_CSS_PROPERTY",this,f,g,d);this.currentProperty={name:{value:d,start:f,end:g}};if(h!==":")throw h===";"?new c("MISSING_CSS_VALUE",this,f,g,d):new c("UNCAUGHT_CSS_PARSE_ERROR",this,e.interval.start,e.interval.end,i);if(!d||!d.match(/^[a-z\-]+$/)||!this._knownCSSProperty(d))throw new c("INVALID_CSS_PROPERTY_NAME",this,f,g,d);this.stream.markTokenStartAfterSpace(),this._parseValue(a,b,d,f)},_parseValue:function(a,b,d,e){var f=this.stream.eatCSSWhile(/[^}<;]/),g=this.stream.makeToken();if(g===null)throw new c("MISSING_CSS_VALUE",this,e,e+d.length,d);var h=this.stream.end()?"end of stream":this.stream.next(),i="[_parseValue] Expected }, <, or ;, instead found "+h;g.value=g.value.trim();var j=g.value,k=g.interval.start,l=k+j.length;j=this.stripComments(j,k).trim();if(j==="")throw new c("MISSING_CSS_VALUE",this,this.stream.pos-1,this.stream.pos);this.currentProperty.value={value:j,start:k,end:l};if(this.stream.end()&&h!==";"||h==="<")throw new c("UNFINISHED_CSS_VALUE",this,k,l,j);if(h===";")this._bindCurrentRule(),this.stream.markTokenStartAfterSpace(),this._parseDeclaration(a,k,j);else{if(h!=="}")throw new c("UNCAUGHT_CSS_PARSE_ERROR",this,g.interval.start,g.interval.end,i);this.currentRule.declarations.end=this.stream.pos,this._bindCurrentRule(),this.stream.markTokenStartAfterSpace(),this._parseSelector()}},_bindCurrentRule:function(){this.currentRule.declarations.properties.push(this.currentProperty),this.currentProperty=null}},g.prototype={html5Doctype:"<!DOCTYPE html>",voidHtmlElements:["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],htmlElements:["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","bgsound","blink","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","marquee","menu","meta","meter","nav","nobr","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","samp","script","section","select","small","source","spacer","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],obsoleteHtmlElements:["acronym","applet","basefont","big","center","dir","font","isindex","listing","noframes","plaintext","s","strike","tt","xmp"],_knownHTMLElement:function(a){return this.voidHtmlElements.indexOf(a)>-1||this.htmlElements.indexOf(a)>-1||this.obsoleteHtmlElements.indexOf(a)>-1},_knownVoidHTMLElement:function(a){return this.voidHtmlElements.indexOf(a)>-1},parse:function(){this.stream.match(this.html5Doctype,!0,!0)&&(this.domBuilder.fragment.parseInfo={doctype:{start:0,end:this.stream.pos}});while(!this.stream.end())this.stream.peek()=="<"?(this._buildTextNode(),this._parseStartTag()):this.stream.next();this._buildTextNode();if(this.domBuilder.currentNode!=this.domBuilder.fragment)throw new c("UNCLOSED_TAG",this)},_buildTextNode:function(){var a=this.stream.makeToken();a&&this.domBuilder.text(b(a.value),a.interval)},_parseStartTag:function(){if(this.stream.next()!="<")throw new Error('assertion failed, expected to be on "<"');if(this.stream.match("!--",!0)){this._parseComment();return}this.stream.eat(/\//),this.stream.eatWhile(/[\w\d]/);var a=this.stream.makeToken(),b=a.value.slice(1).toLowerCase();if(b[0]=="/"){var d=b.slice(1).toLowerCase();if(this._knownVoidHTMLElement(d))throw new c("CLOSE_TAG_FOR_VOID_ELEMENT",this,d,a);if(!this.domBuilder.currentNode.parseInfo)throw new c("UNEXPECTED_CLOSE_TAG",this,d,a);this.domBuilder.currentNode.parseInfo.closeTag={start:a.interval.start};var e=this.domBuilder.currentNode.nodeName.toLowerCase();if(d!=e)throw new c("MISMATCHED_CLOSE_TAG",this,e,d,a);this._parseEndCloseTag()}else{if(!b||!this._knownHTMLElement(b))throw new c("INVALID_TAG_NAME",b,a);this.domBuilder.pushElement(b,{openTag:{start:a.interval.start}}),this.stream.end()||this._parseEndOpenTag(b)}},_parseComment:function(){var a;while(!this.stream.end()){if(this.stream.match("-->",!0)){a=this.stream.makeToken(),this.domBuilder.comment(a.value.slice(4,-3),a.interval);return}this.stream.next()}throw a=this.stream.makeToken(),new c("UNTERMINATED_COMMENT",a)},_parseEndCloseTag:function(){this.stream.eatSpace();if(this.stream.next()!=">")throw new c("UNTERMINATED_CLOSE_TAG",this);var a=this.stream.makeToken().interval.end;this.domBuilder.currentNode.parseInfo.closeTag.end=a,this.domBuilder.popElement()},_parseEndOpenTag:function(a){while(!this.stream.end())if(this.stream.eatWhile(/[A-Za-z\-]/))this._parseAttribute();else{if(!this.stream.eatSpace()){if(this.stream.peek()==">"||this.stream.match("/>")){if(this.stream.match("/>",!0)){if(!this._knownVoidHTMLElement(a))throw new c("SELF_CLOSING_NON_VOID_ELEMENT",this,a)}else this.stream.next();var b=this.stream.makeToken().interval.end;this.domBuilder.currentNode.parseInfo.openTag.end=b,a&&this._knownVoidHTMLElement(a)&&this.domBuilder.popElement();if(!this.stream.end()&&a==="style"){var d=this.cssParser.parse();this.domBuilder.text(d.value,d.parseInfo)}return}throw new c("UNTERMINATED_OPEN_TAG",this)}this.stream.makeToken()}},_parseAttribute:function(){var a=this.stream.makeToken();a.value=a.value.toLowerCase(),this.stream.eatSpace();if(this.stream.peek()=="="){this.stream.next(),this.stream.eatSpace(),this.stream.makeToken();var d=this.stream.next();if(d!=='"'&&d!=="'")throw new c("UNQUOTED_ATTR_VALUE",this);d==='"'?this.stream.eatWhile(/[^"]/):this.stream.eatWhile(/[^']/);if(this.stream.next()!==d)throw new c("UNTERMINATED_ATTR_VALUE",this,a);var e=this.stream.makeToken(),f=b(e.value.slice(1,-1));this.domBuilder.attribute(a.value,f,{name:a.interval,value:e.interval})}else this.stream.makeToken(),this.domBuilder.attribute(a.value,"",{name:a.interval})}},h.prototype={pushElement:function(a,b){var c=this.document.createElement(a);c.parseInfo=b,this.currentNode.appendChild(c),this.currentNode=c},popElement:function(){this.currentNode=this.currentNode.parentNode},comment:function(a,b){var c=this.document.createComment("");c.nodeValue=a,c.parseInfo=b,this.currentNode.appendChild(c)},attribute:function(a,b,c){var d=this.document.createAttribute(a);d.parseInfo=c,d.nodeValue=b,this.currentNode.attributes.setNamedItem(d)},text:function(a,b){var c=this.document.createTextNode(a);c.parseInfo=b,this.currentNode.appendChild(c)}};var i={HTML_ELEMENT_NAMES:g.prototype.voidHtmlElements.concat(g.prototype.htmlElements.concat(g.prototype.obsoleteHtmlElements)),CSS_PROPERTY_NAMES:f.prototype.cssProperties,replaceEntityRefs:b,Stream:e,HTML:function(a,b,c){var d=new e(b),f,i,j=null;a.pushElement?f=a:f=new h(a),i=new g(d,f);try{i.parse()}catch(k){if(!k.parseInfo)throw k;j=k.parseInfo}return(c||[]).forEach(function(a){j||(j=a(b,f.fragment)||null)}),{document:f.fragment,error:j}},findError:function(a,b){return this.HTML(document,a,b).error}};if(typeof define!="function")return i;define(function(){return i})}();